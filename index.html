<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link hrel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.css' rel='stylesheet'/>
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet'/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/arc.js/v0.1.0/arc.js'></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet' />

    <title>Dutch Musuems</title>

    <style>
        .filter-ctrl {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
            width: 180px;
        }

        .filter-ctrl input[type=text] {
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            width: 100%;
            border: 0;
            background-color: #fff;
            height: 40px;
            margin: 0;
            color: rgba(0,0,0,.5);
            padding: 10px;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.1);
            border-radius: 3px;
        }
    </style>
</head>

<body style="padding-left: 10px;">

<div class="container-fluid main">
    <div class="row">
        <div class="row" id="toprow">
            <div class="col-xs-12" align="center">
                <h2>Dutch Musuems</h2>
            </div>
        </div>
        <div class="col-xs-12 col-md-12">
            <div class="row row-map" id="midrow">
                <div class="col-xs-12 col-sm-12 col-md-12">
                    <!-- Bootstrap-map-js -->
                    <div id="maincontainer">
                        <div id="map" style="height: 600px"></div>
                    </div>
                </div>
                <div class="row" id="bottomrow">
                    <div class="col-xs-12 col-sm-12 col-md-12"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    //for the map
    /*
    mapboxgl.accessToken = 'pk.eyJ1IjoiaXRjYWVybyIsImEiOiJjaWxuZmtlOHQwMDA2dnNseWMybHhvMXh0In0.DObc4iUf1_86LxJGF0RHog';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v9',
        center: [5.6495976, 52.3533156],
        zoom: 6.5
    });
    map.setMinZoom(5);
    map.setMaxZoom(15);

    map.on('load', function () {

        d3.json('data/musuem_list.geojson', function (err, data) {

            map.addSource("musuems", {
                "type": "geojson",
                "data": data
            });

            map.addLayer({
                "id": "musuem",
                "type": "circle",
                "source": "musuems",
                "paint": {
                    "circle-radius": 4,
                    "circle-color": "#46b39d"
                },
                //"filter": ["==", "$type", "Point"],
            });


            data.features.forEach(function(d,i){

                //console.log(d);
                var symbol = d.properties['name'];
                var layerID = 'poi-' + symbol;

                // Add a layer for this symbol type if it hasn't been added already.
                map.addLayer({
                    "id": layerID,
                    "type": "symbol",
                    "source": "musuems",
                    "layout": {
                        "icon-allow-overlap": true,
                        "text-field": symbol,
                        "text-font": ["Open Sans Bold", "Arial Unicode MS Bold"],
                        "text-size": 11,
                        "text-transform": "uppercase",
                        "text-letter-spacing": 0.05,
                        "text-offset": [0, 1.5]
                    },
                    "paint": {
                        "text-color": "#202",
                        "text-halo-color": "#fff",
                        "text-halo-width": 2
                    },
                    "filter": ["==", "icon", symbol]
                });


            });

        });
    });

    */

    L.mapbox.accessToken = 'pk.eyJ1IjoiaXRjYWVybyIsImEiOiJjaWxuZmtlOHQwMDA2dnNseWMybHhvMXh0In0.DObc4iUf1_86LxJGF0RHog';
    var map = L.mapbox.map('map', 'mapbox.streets');
    map.setView([52.3533156, 5.6495976], 6.5);

    // Build a marker from a simple GeoJSON object:

    d3.json('data/musuem_list.geojson', function (err, data) {

        data.features.forEach(function(d,i){


            //console.log(d);

            var lat = d.geometry.coordinates[0];
            var log = d.geometry.coordinates[1];

            console.log(lat,log);

            var marker = L.mapbox.featureLayer({
                type: 'Feature',
                geometry: {
                    type: 'Point',
                    coordinates: [lat, log]
                },
                properties: {
                    title: d.properties.name,
                    'marker-color': '#f86767'
                }
            }).addTo(map);
        });

    });


    // Iterate over the featureLayer we've called "marker"
    // and open its popup instead of clicking to trigger it.
    marker.eachLayer(function(m) {
        m.openPopup();
    });


</script>

</body>
</html>